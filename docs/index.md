---
marp: true
title: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ JVM
description: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ JVM
theme: vtb
template: giala
paginate: true
_paginate: false

---

<!-- _class: lead2-->

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ JVM
## __–°–º–∏—Ä–Ω–æ–≤ –í—è—á–µ—Å–ª–∞–≤, 2021__

---

# –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –ù–¢

![bg cover](img/omsk.jpg)


---

# –ú–Ω–æ–≥–æ JVM –≤ Kubernetes Pod, Kafka, Elastic Search
![bg right h:700px](img/monitoring-4.svg)

---


# 100 JVM —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º –∏ –±–∞–∑–æ–π
![bg right h:700px](img/monitoring-5.svg)

---


# –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ–º –≤—Ö–æ–¥–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –º–µ—Ç—Ä–∏–∫–∞–º
![bg w:100% ](img/monitoring-7.png)

---

![bg w:100% ](img/monitoring-7.png)

---

![bg w:100% ](img/monitoring-8.png)

---

![bg h:100% ](img/monitoring-9.png)

---

![bg h:100% ](img/monitoring-10.png)

---

![bg h:100% ](img/monitoring-11.png)

---

# –ú–µ—Ç—Ä–∏–∫–∏ JVM ‚Äî —á–∞—Å—Ç—å –º–µ—Ç—Ä–∏–∫
![bg h:100% ](img/monitoring-11.png)

---

# –ú–µ—Ç—Ä–∏–∫–∏ JVM ‚Äî —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∏ —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞
![bg h:100% ](img/plastic-5527525_1920.jpg)

---

# –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

![bg h:100% ](img/plastic-5527525_1920.jpg)

![bg h:100% ](img/cairn-4247395_1920.jpg)

---

# –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

![bg h:100% ](img/plastic-5527525_1920.jpg)

![bg h:100% ](img/Logins.png)

---

![bg h:100% ](img/Logins.png)

---

![bg h:100% ](img/cpu.png)

---

# –ü—Ä–æ–±–ª–µ–º—ã —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

![bg h:100% right ](img/problems.svg)

---

# –ù–µ—Å–æ–æ—Ç–≤–µ—Å—Ç–≤–∏–µ –∑–∞–¥–∞–Ω–Ω—ã—Ö –æ–ø—Ü–∏–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º

![bg w:100% right ](img/problems.reconfig.svg)

---

# –ù–µ—Å–æ–æ—Ç–≤–µ—Å—Ç–≤–∏–µ –∑–∞–¥–∞–Ω–Ω—ã—Ö –æ–ø—Ü–∏–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º

![bg h:100% right ](img/problems.reconfig.2.png)

---

# –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –±–æ–ª—å—à–µ, —á–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ (—É—Ç–µ—á–∫–∞?)

![bg w:100% right ](img/problems.memory.1.svg)

---

# –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–∞–º—è—Ç–∏ –±–æ–ª—å—à–µ, —á–µ–º –µ—Å—Ç—å

![bg w:100% right ](img/problems.memory.2.svg)

---

# –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î –±–æ–ª—å—à–µ, —á–µ–º –µ—Å—Ç—å

![bg w:100% right ](img/problems.db.pool.svg)

---

# –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î –º–µ–Ω—å—à–µ, —á–µ–º –Ω—É–∂–Ω–æ

![bg w:100% right ](img/problems.db.pool.svg)

---

# –£—Ç–µ—á–∫–∞ —Ñ–∞–π–ª–æ–≤—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π, ...

![bg w:100% right ](img/problems.file.leak.svg)

---

# –≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ JVM

![bg h:100% right ](img/problems.svg)

---

# –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ JVM

![bg w:100%](img/java-version.svg)

---

![bg w:100%](img/java-version.svg)

---

# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç JMX –∏ JavaAgent –æ—Ç Jolokia –∏ Prometheus

![bg w:90% right](img/openjdk.svg)

---

# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç JMX, –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ Agent-—ã

![bg w:90% right](img/openj9.svg)

---

# –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ JavaAgent-—ã

![bg ](img/hub.docker.com-u-fabric8.png)

---

![bg ](img/hub.docker.com-u-fabric8.png)

---

![bg ](img/hub.docker.com-u-fabric8-images.png)

---

![bg ](img/hub.docker.com-u-fabric8-images-hl.png)

---

![bg w:140%](img/hub.docker.com-u-fabric8-images-hl.png)

---

![bg](img/java-centos-openjdk8-jre.png)

---

![bg ](img/java-centos-openjdk8-jre-hl.png)

---

# –í–∞—Ä–∏–∞–Ω—Ç—ã —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ JVM

![bg w:90% right](img/jvm-agent-jmx.png)

---

![bg w:90%](img/jvm-agent-jmx.png)

---

![h:50% bg](img/jvm-jolokia-telegraf.png)

---

![w:95% bg](img/jvm-jolokia-telegraf-influxdb.png)

---

![w:95% bg](img/jvm-prometheus.png)

---

![w:95% bg](img/jvm-telegraf-prometheus.png)

---

![w:95% bg](img/jvm-jmx-jmx_exporter_server.png)

---

![w:95% bg](img/jvm-jmx-jmx_exporter_server-prometheus.png)

---

![w:95% bg](img/jvm-jmx-telegraf.png)

---

![w:95% bg](img/jvm-jmx-jmxtrans.png)

---

![w:95% bg](img/jvm-jmxtrans.png)

---

<!-- _class: head -->

# –£—Ç–∏–ª–∏—Ç–∞ JMC - –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ—Å–º–æ—Ç—Ä MBean

![w:95% bg ](img/jvm-jmx-jmc.png)

---

![w:95% bg ](img/jvm-jmx-jmc.png)

---

![bg ](img/jmc_path.png)

---

![bg w:100%](img/jmc-version.png)

---

![bg w:100%](img/jmc_view2.png)

---

![bg h:100%](img/jmc-select-MBean-path.png)


---

<!-- _class: head -->

#  –ò–∑ jolokia —á–µ—Ä–µ–∑ telegraf (jolokia2) –≤ InfluxDB 

![w:95% bg](img/jvm-jolokia-telegraf-influxdb.png)

---

<!-- _class: head -->

# –î–ª—è –∫–∞–∂–¥–æ–≥–æ MBean –Ω—É–∂–Ω–æ –ø—Ä–∞–≤–∏–ª–æ jolokia2 üôÅ

![w:95% bg](img/telegraf-jolokia2.png)

---

<!-- _class: head -->

# –î–ª—è –∫–∞–∂–¥–æ–≥–æ MBean –Ω—É–∂–Ω–æ –ø—Ä–∞–≤–∏–ª–æ jolokia2 üôÅ

![w:95% bg](img/telegraf-jolokia2-hl.png)

---

<!-- _class: head -->

# 1. –í—ã–±–∏—Ä–∞–µ–º MBean –≤ JMC

![w:95% bg](img/jmc-select-MBean.png)

---

<!-- _class: head -->

# MBean "Runtime", –∞ —Ç–æ—á–Ω–µ–µ java.lang:type=Runtime

![w:95% bg](img/jmc-select-MBean.png)

---


![w:155% bg](img/jmc-select-MBean.png)



---


<!-- _class: head -->

# 2. –í—ã–±–∏—Ä–∞–µ–º –∞—Ç—Ç—Ä–∏–±—É—Ç(—ã) MBean –≤ JMC

![w:95% bg](img/jmc-select-MBean-path.png)

---

<!-- _class: head -->

# –û–±—Ä–∞—â–∞–µ–º –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ç–∏–ø –∞—Ç—Ç—Ä–∏–±—É—Ç–æ–≤

![w:100% bg](img/mbean-attribute-type.png)

---


![w:100% bg](img/mbean-attribute-type-hl.png)

---

<!-- _class: head -->

# –í—ã–±—Ä–∞–ª–∏ –∞—Ç—Ç—Ä–∏–±—É—Ç "Uptime"

![w:100% bg](img/mbean-attribute-type-hl.png)


---

<!-- _class: head -->

# 3. –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª–æ jolokia2_agent  (Telegraf)

![w:95% bg](img/telegraf-jolokia2-hl.png)

---

<!-- _class: head -->

# 1. –í—ã–±–∏—Ä–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ MBean –≤ JMC

![w:95% bg](img/jmc-select-MBean-2.png)

---

<!-- _class: head -->

# java.lang:type=MemoryPool,name=G1 Survivor ...

![w:155% bg](img/jmc-select-MBean-2.png)

---

<!-- _class: head -->

# java.lang:type=MemoryPool,name=*: –º–∞—Å–∫–∞ –≤ name

![w:155% bg](img/jmc-select-MBean-2.png)


---


<!-- _class: head -->

# 2. –í—ã–±–∏—Ä–∞–µ–º –∞—Ç—Ç—Ä–∏–±—É—Ç(—ã) MBean –≤ JMC

![w:95% bg](img/jmc-select-MBean-path2.png)

---


![w:155% bg](img/jmc-select-MBean-path2.png)

---


![w:155% bg](img/jmc-select-MBean-path2-hl.png)

---

<!-- _class: head -->

# –í—ã–±—Ä–∞–ª–∏ CollectionUsage, PeakUsage, Usage

![w:95% bg](img/jmc-select-MBean-path2-hl.png)

---

<!-- _class: head -->

# 3. –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª–æ jolokia2_agent (Telegraf)

![w:95% bg](img/telegraf_jolokia2_agent_ast.png)

---

<!-- _class: head -->

# –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ üôÇ

![bg](img/jolokia2-sample.png)

---

<!-- _class: head -->

# –ò –≥–æ—Ç–æ–≤—ã–µ –¥–æ—Å–∫–∏ Grafana –¥–ª—è Jolokia

![bg](img/grafana-jolokia.png)

---

<!-- _class: head -->

# –ò–∑ jmx_exporter –≤ Prometheus

![bg w:95%](img/jvm-prometheus-only.png)

---

<!-- _class: head -->

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ jmx_exporter –¥–ª—è Prometheus  –ø—Ä–æ—â–µ

![bg h:100%](img/jmx_exporter.yaml.png)

---

<!-- _class: head -->

# –ù–æ –≥–æ—Ä–∞–∑–¥–æ —Å–ª–æ–∂–Ω–µ–µ üôÇ –∏–∑-–∑–∞ RegExp-–æ–≤

![bg h:100%](img/jmx_exporter.yaml.2.png)

---

![bg w:95%](img/jvm-prometheus-only.png)

---

<!-- _class: head -->

# –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ JVM

![bg h:60%](img/jolokia_cache.png)

![bg h:60%](img/jmx_exporter_no_cache.png)

---

![bg h:100%](img/jolokia_cache.png)

---

![bg h:100%](img/jmx_exporter_no_cache.png)


---

<!-- _class: head -->

# Jolokia —Ä–µ–∂–µ –∏—â–µ—Ç MBean-—ã

![bg h:60%](img/jolokia_cache.png)

![bg h:60%](img/jmx_exporter_no_cache.png)

---

<!-- _class: head -->

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –≤ Grafana

![bg w:95%](img/all.png)

---

![bg w:95%](img/grafana_ds.svg)

---

<!-- _class: head -->

# –ë–µ—Ä–µ–≥–∏—Ç–µ –∑—Ä–µ–Ω–∏–µ

![bg ](img/grafana-line-width.png)


---


![bg ](img/grafana-line-width-hl.png)

---

<!-- _class: head -->

# –°–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —É–±—ã–≤–∞–Ω–∏—é

![bg ](img/grafana-sort-order.PNG)

---


<!-- _class: head -->

# –¢–∞–∫ –ø—Ä–æ—â–µ —á–∏—Ç–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏

![bg ](img/grafana-sort-order-2.PNG)

---

<!-- _class: head -->

# –õ—É—á—à–µ —Å–æ–±–∏—Ä–∞—Ç—å –ø–æ—Ä–µ–∂–µ, –Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–¥–æ–ª—å—à–µ 

![bg ](img/grafana-stability.png)


---

# 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–º –Ω–µ —Ç–æ–ª—å–∫–æ JVM

![bg w:100% right ](img/monitoring-11.png)

---

# 2. –°–ø–æ—Å–æ–± –∑–∞–≤–∏—Å–∏—Ç –æ—Ç JVM –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

![bg w:100% right vertical](img/java-version.svg)

![bg w:100% right](img/jvm-jmx-jmx_exporter_server-prometheus.png)

---

# 3. –í–∞–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —É—Ç–µ—á–∫–∏

![bg w:100% right](img/telegraf_jolokia2_agent_ast.png)

---

# 4. –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å —Ä–∞–∑ –≤ 30 —Å–µ–∫

![bg w:100% right ](img/grafana-stability.png)

---


<!-- _class: lead2-->

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ JVM
## owasp@ya.ru, t.me/qa_load